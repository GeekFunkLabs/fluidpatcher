<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>API Reference - FluidPatcher</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "API Reference";
        var mkdocs_page_input_path = "api_reference.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> FluidPatcher
        </a>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../basic_usage/">Basic Usage</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../soundfonts/">Soundfonts</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../bank_files/">Creating Banks</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../ladspa_plugins/">Plugins</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">API Reference</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#fluidpatcher.FluidPatcher">FluidPatcher</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#fluidpatcher.FluidPatcher.currentbank">currentbank</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#fluidpatcher.FluidPatcher.bankdir">bankdir</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#fluidpatcher.FluidPatcher.sfdir">sfdir</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#fluidpatcher.FluidPatcher.mfilesdir">mfilesdir</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#fluidpatcher.FluidPatcher.plugindir">plugindir</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#fluidpatcher.FluidPatcher.patches">patches</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#fluidpatcher.FluidPatcher.__init__">__init__</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#fluidpatcher.FluidPatcher.update_config">update_config</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#fluidpatcher.FluidPatcher.load_bank">load_bank</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#fluidpatcher.FluidPatcher.save_bank">save_bank</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#fluidpatcher.FluidPatcher.apply_patch">apply_patch</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#fluidpatcher.FluidPatcher.add_patch">add_patch</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#fluidpatcher.FluidPatcher.update_patch">update_patch</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#fluidpatcher.FluidPatcher.delete_patch">delete_patch</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#fluidpatcher.FluidPatcher.fluidsetting_get">fluidsetting_get</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#fluidpatcher.FluidPatcher.fluidsetting_set">fluidsetting_set</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#fluidpatcher.FluidPatcher.add_router_rule">add_router_rule</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#fluidpatcher.FluidPatcher.send_event">send_event</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#fluidpatcher.FluidPatcher.solo_soundfont">solo_soundfont</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#fluidpatcher.FluidPatcher.select_sfpreset">select_sfpreset</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">FluidPatcher</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">API Reference</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/GeekFunkLabs/fluidpatcher/edit/master/docs/api_reference.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="api-reference">API Reference</h1>


<div class="doc doc-object doc-class">



<h2 id="fluidpatcher.FluidPatcher" class="doc doc-heading">
            <code>fluidpatcher.FluidPatcher</code>


</h2>


    <div class="doc doc-contents first">


      <p>An interface for running FluidSynth using patches</p>
<p>Provides methods for:</p>
<ul>
<li>loading/saving the config file and bank files</li>
<li>applying/creating/copying/deleting patches</li>
<li>directly controlling the Synth by modifying fluidsettings,
  manually adding router rules, and sending MIDI events</li>
<li>loading a single soundfont and browsing its presets</li>
</ul>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Attributes:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>midi_callback</code></b>
              â€“
              <div class="doc-md-description">
                <p>a function that takes a pfluidsynth.Midisignal instance
as its argument. Will be called when MIDI events are received or
custom router rules are triggered. This allows scripts to define
and handle their own custom router rules and/or monitor incoming events.  <br />
MidiSignal events have <code>type</code>, <code>chan</code>, <code>par1</code>, and <code>par2</code> events matching
the triggering event. MidiSignals generated by rules have extra attributes
corresponding to the rule parameters, plus a <code>val</code> attribute that is the
result of parameter routing. Rules with a <code>patch</code> parameter will be modified
by FluidPatcher so that the <code>patch</code> attribute corresponds to the patch index.
If <code>patch</code> is -1, <code>val</code> is set to the patch increment.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>See the documentation for information on bank file format.</p>

              <details class="quote">
                <summary>Source code in <code>fluidpatcher/__init__.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">FluidPatcher</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An interface for running FluidSynth using patches</span>

<span class="sd">    Provides methods for:</span>

<span class="sd">    - loading/saving the config file and bank files</span>
<span class="sd">    - applying/creating/copying/deleting patches</span>
<span class="sd">    - directly controlling the Synth by modifying fluidsettings,</span>
<span class="sd">      manually adding router rules, and sending MIDI events</span>
<span class="sd">    - loading a single soundfont and browsing its presets</span>

<span class="sd">    Attributes:</span>
<span class="sd">      midi_callback: a function that takes a pfluidsynth.Midisignal instance</span>
<span class="sd">        as its argument. Will be called when MIDI events are received or</span>
<span class="sd">        custom router rules are triggered. This allows scripts to define</span>
<span class="sd">        and handle their own custom router rules and/or monitor incoming events.    </span>
<span class="sd">        MidiSignal events have `type`, `chan`, `par1`, and `par2` events matching</span>
<span class="sd">        the triggering event. MidiSignals generated by rules have extra attributes</span>
<span class="sd">        corresponding to the rule parameters, plus a `val` attribute that is the</span>
<span class="sd">        result of parameter routing. Rules with a `patch` parameter will be modified</span>
<span class="sd">        by FluidPatcher so that the `patch` attribute corresponds to the patch index.</span>
<span class="sd">        If `patch` is -1, `val` is set to the patch increment.</span>

<span class="sd">    See the documentation for information on bank file format.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfgfile</span><span class="p">,</span> <span class="o">**</span><span class="n">fluidsettings</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates FluidPatcher and starts FluidSynth</span>

<span class="sd">        Starts fluidsynth using settings found in yaml-formatted `cfgfile`.</span>
<span class="sd">        Settings passed via `fluidsettings` will override those in config file.</span>
<span class="sd">        See https://www.fluidsynth.org/api/fluidsettings.xml for a</span>
<span class="sd">        full list and explanation of settings. See documentation</span>
<span class="sd">        for config file format.</span>

<span class="sd">        Args:</span>
<span class="sd">          cfgfile: Path object pointing to config file</span>
<span class="sd">          fluidsettings: dictionary of additional fluidsettings</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cfgfile</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">cfgfile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">parseyaml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfgfile</span><span class="o">.</span><span class="n">read_text</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bank</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">soundfonts</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span> <span class="o">=</span> <span class="n">Synth</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fluidsettings&#39;</span><span class="p">,</span> <span class="p">{}),</span> <span class="o">**</span><span class="n">fluidsettings</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">midi_callback</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_midisignal_handler</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_channels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fluidsetting_get</span><span class="p">(</span><span class="s1">&#39;synth.midi-channels&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patchcord</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;patchcordxxx&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;lib&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugindir</span> <span class="o">/</span> <span class="s1">&#39;patchcord&#39;</span><span class="p">,</span> <span class="s1">&#39;audio&#39;</span><span class="p">:</span> <span class="s1">&#39;mono&#39;</span><span class="p">}}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">midi_callback</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">currentbank</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;a Path object pointing to the current bank file&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;currentbank&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="s1">&#39;currentbank&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">bankdir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Path to bank files&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;bankdir&#39;</span><span class="p">,</span> <span class="s1">&#39;banks&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sfdir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Path to soundfonts&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;soundfontdir&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bankdir</span> <span class="o">/</span> <span class="s1">&#39;../sf2&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">mfilesdir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Path to MIDI files&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mfilesdir&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bankdir</span> <span class="o">/</span> <span class="s1">&#39;../midi&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">plugindir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Path to LADSPA effects&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;plugindir&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">patches</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;List of patch names in the current bank&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;patches&#39;</span><span class="p">,</span> <span class="p">{}))</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bank</span> <span class="k">else</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">update_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write current configuration stored in `cfg` to file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfgfile</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">renderyaml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">load_bank</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bankfile</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load a bank from a file or from raw yaml text</span>

<span class="sd">        Parses a yaml stream from a string or file and stores as a</span>
<span class="sd">        nested collection of dict and list objects. The top-level</span>
<span class="sd">        dict must have at minimum a `patches` element or an error</span>
<span class="sd">        is raised. If loaded from a file successfully, that file</span>
<span class="sd">        is set as `currentbank` in the config - call update_config()</span>
<span class="sd">        to make it persistent.</span>

<span class="sd">        Upon loading, resets the synth, loads all necessary soundfonts,</span>
<span class="sd">        and applies settings in the `init` element. Returns the yaml stream</span>
<span class="sd">        as a string. If called with no arguments, resets the synth and</span>
<span class="sd">        restores the current bank from memory.</span>

<span class="sd">        Args:</span>
<span class="sd">          bankfile: bank file to load, absolute or relative to `bankdir`</span>
<span class="sd">          raw: string to parse directly</span>

<span class="sd">        Returns: yaml stream that was loaded</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">bankfile</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">raw</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bankdir</span> <span class="o">/</span> <span class="n">bankfile</span><span class="p">)</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span>
                <span class="n">bank</span> <span class="o">=</span> <span class="n">parseyaml</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">bankfile</span><span class="p">)</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;currentbank&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;currentbank&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">raise</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bank</span> <span class="o">=</span> <span class="n">bank</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;currentbank&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">bankfile</span><span class="p">)</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">raw</span><span class="p">:</span>
            <span class="n">bank</span> <span class="o">=</span> <span class="n">parseyaml</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bank</span> <span class="o">=</span> <span class="n">bank</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reset_synth</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_bankfonts</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">zone</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bank</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;patches&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">midi</span> <span class="ow">in</span> <span class="n">zone</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;midiplayers&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">midi</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mfilesdir</span> <span class="o">/</span> <span class="n">midi</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">fx</span> <span class="ow">in</span> <span class="n">zone</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ladspafx&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">fx</span><span class="p">[</span><span class="s1">&#39;lib&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugindir</span> <span class="o">/</span> <span class="n">fx</span><span class="p">[</span><span class="s1">&#39;lib&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">syx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;init&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sysex&#39;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="n">syx</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">opt</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;init&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fluidsettings&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fluidsetting_set</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;init&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;messages&#39;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">send_event</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">raw</span>

    <span class="k">def</span> <span class="nf">save_bank</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bankfile</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save a bank file</span>

<span class="sd">        Saves the current bank in memory to `bankfile` after rendering it as</span>
<span class="sd">        a yaml stream. If `raw` is provided, it is parsed as the new bank and</span>
<span class="sd">        its exact contents are written to the file.</span>

<span class="sd">        Args:</span>
<span class="sd">          bankfile: file to save, absolute or relative to `bankdir`</span>
<span class="sd">          raw: exact text to save</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">raw</span><span class="p">:</span>
            <span class="n">bank</span> <span class="o">=</span> <span class="n">parseyaml</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bank</span> <span class="o">=</span> <span class="n">bank</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">raw</span> <span class="o">=</span> <span class="n">renderyaml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bank</span><span class="p">)</span>
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bankdir</span> <span class="o">/</span> <span class="n">bankfile</span><span class="p">)</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;currentbank&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">bankfile</span><span class="p">)</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">apply_patch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patch</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Select a patch and apply its settings</span>

<span class="sd">        Read the settings for the patch specified by index or name and combine</span>
<span class="sd">        them with bank-level settings. Select presets on specified channels and</span>
<span class="sd">        unsets others, clears router rules and applies new ones, activates </span>
<span class="sd">        players and effects and deactivates unused ones, send messages, and</span>
<span class="sd">        applies fluidsettings. Patch settings are applied after bank settings.</span>
<span class="sd">        If the specified patch isn&#39;t found, only bank settings are applied.</span>

<span class="sd">        Args:</span>
<span class="sd">          patch: patch index or name</span>

<span class="sd">        Returns: a list of warnings, if any</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warnings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">patch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_patch</span><span class="p">(</span><span class="n">patch</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">mrg</span><span class="p">(</span><span class="n">kw</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kw</span><span class="p">,</span> <span class="p">{})</span> <span class="o">|</span> <span class="n">patch</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kw</span><span class="p">,</span> <span class="p">{})</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kw</span><span class="p">,</span> <span class="p">[])</span> <span class="o">+</span> <span class="n">patch</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kw</span><span class="p">,</span> <span class="p">[])</span>
        <span class="c1"># presets</span>
        <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_channels</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">p</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span> <span class="ow">or</span> <span class="n">patch</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ch</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">program_select</span><span class="p">(</span><span class="n">ch</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sfdir</span> <span class="o">/</span> <span class="n">p</span><span class="o">.</span><span class="n">sfont</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">bank</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">prog</span><span class="p">):</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unable to select preset </span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2"> on channel </span><span class="si">{</span><span class="n">ch</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">program_unset</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span>
        <span class="c1"># sysex</span>
        <span class="k">for</span> <span class="n">syx</span> <span class="ow">in</span> <span class="n">mrg</span><span class="p">(</span><span class="s1">&#39;sysex&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="n">syx</span><span class="p">)</span>
        <span class="c1"># fluidsettings</span>
        <span class="k">for</span> <span class="n">opt</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">mrg</span><span class="p">(</span><span class="s1">&#39;fluidsettings&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fluidsetting_set</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
        <span class="c1"># sequencers, arpeggiators, midiplayers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">players_clear</span><span class="p">(</span><span class="n">save</span><span class="o">=</span><span class="p">[</span><span class="o">*</span><span class="n">mrg</span><span class="p">(</span><span class="s1">&#39;sequencers&#39;</span><span class="p">),</span> <span class="o">*</span><span class="n">mrg</span><span class="p">(</span><span class="s1">&#39;arpeggiators&#39;</span><span class="p">),</span> <span class="o">*</span><span class="n">mrg</span><span class="p">(</span><span class="s1">&#39;midiplayers&#39;</span><span class="p">)])</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">seq</span> <span class="ow">in</span> <span class="n">mrg</span><span class="p">(</span><span class="s1">&#39;sequencers&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">sequencer_add</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">seq</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">arp</span> <span class="ow">in</span> <span class="n">mrg</span><span class="p">(</span><span class="s1">&#39;arpeggiators&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">arpeggiator_add</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">arp</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">midi</span> <span class="ow">in</span> <span class="n">mrg</span><span class="p">(</span><span class="s1">&#39;midiplayers&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">midiplayer_add</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">midi</span><span class="p">)</span>
        <span class="c1"># ladspa effects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">fxchain_clear</span><span class="p">(</span><span class="n">save</span><span class="o">=</span><span class="n">mrg</span><span class="p">(</span><span class="s1">&#39;ladspafx&#39;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">fx</span> <span class="ow">in</span> <span class="p">(</span><span class="n">mrg</span><span class="p">(</span><span class="s1">&#39;ladspafx&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">patchcord</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">fxchain_add</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">fx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">fxchain_connect</span><span class="p">()</span>
        <span class="c1"># router rules -- invert b/c fluidsynth applies rules last-first</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">router_default</span><span class="p">()</span>
        <span class="n">rules</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="n">mrg</span><span class="p">(</span><span class="s1">&#39;router_rules&#39;</span><span class="p">)][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;clear&#39;</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">router_clear</span><span class="p">()</span>
            <span class="n">rules</span> <span class="o">=</span> <span class="n">rules</span><span class="p">[:</span><span class="n">rules</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;clear&#39;</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">:</span>
            <span class="n">rule</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">router_addrule</span><span class="p">)</span>
        <span class="c1"># midi messages</span>
        <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">mrg</span><span class="p">(</span><span class="s1">&#39;messages&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">send_event</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">warnings</span>

    <span class="k">def</span> <span class="nf">add_patch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">addlike</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a new patch</span>

<span class="sd">        Create a new empty patch, or one that copies all settings</span>
<span class="sd">        other than instruments from an existing patch</span>

<span class="sd">        Args:</span>
<span class="sd">          name: a name for the new patch</span>
<span class="sd">          addlike: number or name of an existing patch</span>

<span class="sd">        Returns: the index of the new patch</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;patches&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bank</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">bank</span><span class="p">[</span><span class="s1">&#39;patches&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bank</span><span class="p">[</span><span class="s1">&#39;patches&#39;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">addlike</span><span class="p">:</span>
            <span class="n">addlike</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_patch</span><span class="p">(</span><span class="n">addlike</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">addlike</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bank</span><span class="p">[</span><span class="s1">&#39;patches&#39;</span><span class="p">][</span><span class="n">name</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">addlike</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_patch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patch</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the current patch</span>

<span class="sd">        Instruments and controller values can be changed by program change (PC)</span>
<span class="sd">        and continuous controller (CC) messages, but these will not persist</span>
<span class="sd">        in the patch unless this function is called. Settings can be saved to</span>
<span class="sd">        a new patch by first calling add_patch(), then update_patch() on the</span>
<span class="sd">        new patch. The bank file must be saved for updated patches to become</span>
<span class="sd">        permanent.</span>

<span class="sd">        Args:</span>
<span class="sd">          patch: index or name of the patch to update</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">patch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_patch</span><span class="p">(</span><span class="n">patch</span><span class="p">)</span>
        <span class="n">messages</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">patch</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;messages&#39;</span><span class="p">,</span> <span class="p">[]))</span>
        <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_channels</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">cc</span><span class="p">,</span> <span class="n">default</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">_CC_DEFAULTS</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">default</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span> <span class="k">continue</span>
                <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">get_cc</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">cc</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">val</span> <span class="o">!=</span> <span class="n">default</span><span class="p">:</span>
                    <span class="n">messages</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">MidiMessage</span><span class="p">(</span><span class="s1">&#39;cc&#39;</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">cc</span><span class="p">,</span> <span class="n">val</span><span class="p">))</span>
            <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">program_info</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">info</span><span class="p">:</span>
                <span class="n">patch</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="n">sfont</span><span class="p">,</span> <span class="n">bank</span><span class="p">,</span> <span class="n">prog</span> <span class="o">=</span> <span class="n">info</span>
            <span class="n">sfrel</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">sfont</span><span class="p">)</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sfdir</span><span class="p">)</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()</span>
            <span class="n">patch</span><span class="p">[</span><span class="n">channel</span><span class="p">]</span> <span class="o">=</span> <span class="n">SFPreset</span><span class="p">(</span><span class="n">sfrel</span><span class="p">,</span> <span class="n">bank</span><span class="p">,</span> <span class="n">prog</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">messages</span><span class="p">:</span>
            <span class="n">patch</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">delete_patch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patch</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete a patch from the bank in memory</span>

<span class="sd">        Bank file must be saved for deletion to be permanent</span>

<span class="sd">        Args:</span>
<span class="sd">          patch: index or name of the patch to delete</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">patch</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patches</span><span class="p">[</span><span class="n">patch</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">patch</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">bank</span><span class="p">[</span><span class="s1">&#39;patches&#39;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_bankfonts</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">fluidsetting_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opt</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the current value of a FluidSynth setting</span>

<span class="sd">        Args:</span>
<span class="sd">          opt: setting name</span>

<span class="sd">        Returns: the setting&#39;s current value as float, int, or str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">fluidsetting_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">patch</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Change a FluidSynth setting</span>

<span class="sd">        Modifies a FluidSynth setting. Settings without a &quot;synth.&quot; prefix</span>
<span class="sd">        are ignored. If `patch` is provided, these settings are also added to</span>
<span class="sd">        the current bank in memory at bank level, and any conflicting</span>
<span class="sd">        settings are removed from the specified patch - which should ideally</span>
<span class="sd">        be the current patch so that the changes can be heard. The bank file</span>
<span class="sd">        must be saved for the changes to become permanent.</span>

<span class="sd">        Args:</span>
<span class="sd">          opt: setting name</span>
<span class="sd">          val: new value to set, type depends on setting</span>
<span class="sd">          patch: patch name or index</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">opt</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;synth.&#39;</span><span class="p">):</span> <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">setting</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">patch</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;fluidsettings&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bank</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bank</span><span class="p">[</span><span class="s1">&#39;fluidsettings&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bank</span><span class="p">[</span><span class="s1">&#39;fluidsettings&#39;</span><span class="p">][</span><span class="n">opt</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="n">patch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_patch</span><span class="p">(</span><span class="n">patch</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;fluidsettings&#39;</span> <span class="ow">in</span> <span class="n">patch</span> <span class="ow">and</span> <span class="n">opt</span> <span class="ow">in</span> <span class="n">patch</span><span class="p">[</span><span class="s1">&#39;fluidsettings&#39;</span><span class="p">]:</span>
                <span class="k">del</span> <span class="n">patch</span><span class="p">[</span><span class="s1">&#39;fluidsettings&#39;</span><span class="p">][</span><span class="n">opt</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">add_router_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">pars</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a router rule to the Synth</span>

<span class="sd">        Directly add a router rule to the Synth. This rule will be added</span>
<span class="sd">        after the current bank- and patch-level rules. The rule is not</span>
<span class="sd">        saved to the bank, and will disappear if a patch is applied</span>
<span class="sd">        or the synth is reset.</span>

<span class="sd">        Returns:</span>
<span class="sd">          pars: router rule as a set of key=value pairs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">RouterRule</span><span class="p">(</span><span class="o">**</span><span class="n">pars</span><span class="p">)</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">router_addrule</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">send_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;note&#39;</span><span class="p">,</span> <span class="n">chan</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">par1</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">par2</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Send a MIDI event to the Synth</span>

<span class="sd">        Sends a MidiMessage, or constructs one from a bank file-styled string</span>
<span class="sd">        (&lt;type&gt;:&lt;channel&gt;:&lt;par1&gt;:&lt;par2&gt;) or keywords and sends it</span>
<span class="sd">        to the Synth, which will apply all current router rules.</span>

<span class="sd">        Args:</span>
<span class="sd">          msg: MidiMessage instance or string</span>
<span class="sd">          type: event type as string</span>
<span class="sd">          chan: MIDI channel</span>
<span class="sd">          par1: first parameter, integer or note name</span>
<span class="sd">          par2: second parameter for valid types</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">parseyaml</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">msg</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">MidiMessage</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">chan</span><span class="p">,</span> <span class="n">par1</span><span class="p">,</span> <span class="n">par2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">send_event</span><span class="p">(</span><span class="o">*</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">solo_soundfont</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">soundfont</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Suspend the current bank and load a single soundfont</span>

<span class="sd">        Resets the Synth, loads a single soundfont, and creates router</span>
<span class="sd">        rules that route messages from all channels to channel 1.</span>
<span class="sd">        Scans through each bank and program in order and retrieves the</span>
<span class="sd">        preset name. After this, select_sfpreset() can be used to play</span>
<span class="sd">        any instrument in the soundfont. Call load_bank() with no</span>
<span class="sd">        arguments to restore the current bank.</span>

<span class="sd">        Args:</span>
<span class="sd">          soundfont: soundfont file to load, absolute or relative to `sfdir`</span>

<span class="sd">        Returns: a list of (bank, prog, name) tuples for each preset</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">sfont</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">soundfonts</span> <span class="o">-</span> <span class="p">{</span><span class="n">soundfont</span><span class="p">}:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">unload_soundfont</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sfdir</span> <span class="o">/</span> <span class="n">sfont</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">{</span><span class="n">soundfont</span><span class="p">}</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">soundfonts</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">load_soundfont</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sfdir</span> <span class="o">/</span> <span class="n">soundfont</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">soundfonts</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                <span class="k">return</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">soundfonts</span> <span class="o">=</span> <span class="p">{</span><span class="n">soundfont</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reset_synth</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_channels</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">program_unset</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
        <span class="k">for</span> <span class="nb">type</span> <span class="ow">in</span> <span class="s1">&#39;note&#39;</span><span class="p">,</span> <span class="s1">&#39;cc&#39;</span><span class="p">,</span> <span class="s1">&#39;pbend&#39;</span><span class="p">,</span> <span class="s1">&#39;cpress&#39;</span><span class="p">,</span> <span class="s1">&#39;kpress&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_router_rule</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">type</span><span class="p">,</span> <span class="n">chan</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;2-</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_channels</span><span class="si">}</span><span class="s2">=1&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">get_sfpresets</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sfdir</span> <span class="o">/</span> <span class="n">soundfont</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">select_sfpreset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sfont</span><span class="p">,</span> <span class="n">bank</span><span class="p">,</span> <span class="n">prog</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Select a preset on channel 1</span>

<span class="sd">        Call to select one of the presets in the soundfont loaded</span>
<span class="sd">        by solo_soundfount(). The variable-length garbage argument</span>
<span class="sd">        allows this function to be called by unpacking one of the</span>
<span class="sd">        tuples returned by solo_soundfont().</span>

<span class="sd">        Args:</span>
<span class="sd">          sfont: the soundfont file loaded by solo_soundfont(),</span>
<span class="sd">            absolute or relative to `sfdir`</span>
<span class="sd">          bank: the bank to select</span>
<span class="sd">          prog: the program to select from bank</span>

<span class="sd">        Returns: a list of warnings, empty if none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">sfont</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">soundfonts</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">sfont</span><span class="p">)</span><span class="si">}</span><span class="s2"> is not loaded&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">program_select</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sfdir</span> <span class="o">/</span> <span class="n">sfont</span><span class="p">,</span> <span class="n">bank</span><span class="p">,</span> <span class="n">prog</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Unable to select preset </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">sfont</span><span class="p">)</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">bank</span><span class="si">:</span><span class="s2">03d</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">prog</span><span class="si">:</span><span class="s2">03d</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_midisignal_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sig</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;patch&#39;</span> <span class="ow">in</span> <span class="n">sig</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sig</span><span class="o">.</span><span class="n">patch</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">patches</span><span class="p">:</span>
                <span class="n">sig</span><span class="o">.</span><span class="n">patch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">sig</span><span class="o">.</span><span class="n">patch</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">sig</span><span class="o">.</span><span class="n">patch</span> <span class="o">==</span> <span class="s1">&#39;select&#39;</span><span class="p">:</span>
                <span class="n">sig</span><span class="o">.</span><span class="n">patch</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sig</span><span class="o">.</span><span class="n">val</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">patches</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">sig</span><span class="o">.</span><span class="n">patch</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="s1">&#39;+-&#39;</span><span class="p">:</span>
                <span class="n">sig</span><span class="o">.</span><span class="n">val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sig</span><span class="o">.</span><span class="n">patch</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">sig</span><span class="o">.</span><span class="n">patch</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">sig</span><span class="o">.</span><span class="n">patch</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sig</span><span class="o">.</span><span class="n">patch</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">sig</span><span class="o">.</span><span class="n">patch</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sig</span><span class="o">.</span><span class="n">patch</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="n">sig</span><span class="o">.</span><span class="n">val</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">midi_callback</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">midi_callback</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_refresh_bankfonts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sfneeded</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">zone</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bank</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;patches&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">sfont</span> <span class="ow">in</span> <span class="p">[</span><span class="n">zone</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">sfont</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">zone</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ch</span><span class="p">,</span> <span class="nb">int</span><span class="p">)]:</span>
                <span class="n">sfneeded</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">sfont</span><span class="p">)</span>
        <span class="n">missing</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">sfont</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">soundfonts</span> <span class="o">-</span> <span class="n">sfneeded</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">unload_soundfont</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sfdir</span> <span class="o">/</span> <span class="n">sfont</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">sfont</span> <span class="ow">in</span> <span class="n">sfneeded</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">soundfonts</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">load_soundfont</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sfdir</span> <span class="o">/</span> <span class="n">sfont</span><span class="p">):</span>
                <span class="n">missing</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">sfont</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">soundfonts</span> <span class="o">=</span> <span class="n">sfneeded</span> <span class="o">-</span> <span class="n">missing</span>

    <span class="k">def</span> <span class="nf">_resolve_patch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patch</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">patch</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">patch</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">patches</span><span class="p">):</span>
                <span class="n">patch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patches</span><span class="p">[</span><span class="n">patch</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">patch</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">patch</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">patch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;patches&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">patch</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">return</span> <span class="n">patch</span>

    <span class="k">def</span> <span class="nf">_reset_synth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">players_clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">fxchain_clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">router_default</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">opt</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">{</span><span class="o">**</span><span class="n">_SYNTH_DEFAULTS</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fluidsettings&#39;</span><span class="p">,</span> <span class="p">{})}</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fluidsetting_set</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="fluidpatcher.FluidPatcher.currentbank" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">currentbank</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>a Path object pointing to the current bank file</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="fluidpatcher.FluidPatcher.bankdir" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bankdir</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Path to bank files</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="fluidpatcher.FluidPatcher.sfdir" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sfdir</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Path to soundfonts</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="fluidpatcher.FluidPatcher.mfilesdir" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mfilesdir</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Path to MIDI files</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="fluidpatcher.FluidPatcher.plugindir" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plugindir</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>Path to LADSPA effects</p>
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="fluidpatcher.FluidPatcher.patches" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">patches</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

      <p>List of patch names in the current bank</p>
    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="fluidpatcher.FluidPatcher.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">cfgfile</span><span class="p">,</span> <span class="o">**</span><span class="n">fluidsettings</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Creates FluidPatcher and starts FluidSynth</p>
<p>Starts fluidsynth using settings found in yaml-formatted <code>cfgfile</code>.
Settings passed via <code>fluidsettings</code> will override those in config file.
See https://www.fluidsynth.org/api/fluidsettings.xml for a
full list and explanation of settings. See documentation
for config file format.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>cfgfile</code></b>
              â€“
              <div class="doc-md-description">
                <p>Path object pointing to config file</p>
              </div>
            </li>
            <li>
              <b><code>fluidsettings</code></b>
              â€“
              <div class="doc-md-description">
                <p>dictionary of additional fluidsettings</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>fluidpatcher/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfgfile</span><span class="p">,</span> <span class="o">**</span><span class="n">fluidsettings</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates FluidPatcher and starts FluidSynth</span>

<span class="sd">    Starts fluidsynth using settings found in yaml-formatted `cfgfile`.</span>
<span class="sd">    Settings passed via `fluidsettings` will override those in config file.</span>
<span class="sd">    See https://www.fluidsynth.org/api/fluidsettings.xml for a</span>
<span class="sd">    full list and explanation of settings. See documentation</span>
<span class="sd">    for config file format.</span>

<span class="sd">    Args:</span>
<span class="sd">      cfgfile: Path object pointing to config file</span>
<span class="sd">      fluidsettings: dictionary of additional fluidsettings</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">cfgfile</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">cfgfile</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">parseyaml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfgfile</span><span class="o">.</span><span class="n">read_text</span><span class="p">())</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bank</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">soundfonts</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span> <span class="o">=</span> <span class="n">Synth</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fluidsettings&#39;</span><span class="p">,</span> <span class="p">{}),</span> <span class="o">**</span><span class="n">fluidsettings</span><span class="p">})</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">midi_callback</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_midisignal_handler</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">max_channels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fluidsetting_get</span><span class="p">(</span><span class="s1">&#39;synth.midi-channels&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">patchcord</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;patchcordxxx&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;lib&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugindir</span> <span class="o">/</span> <span class="s1">&#39;patchcord&#39;</span><span class="p">,</span> <span class="s1">&#39;audio&#39;</span><span class="p">:</span> <span class="s1">&#39;mono&#39;</span><span class="p">}}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">midi_callback</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fluidpatcher.FluidPatcher.update_config" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_config</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Write current configuration stored in <code>cfg</code> to file.</p>

            <details class="quote">
              <summary>Source code in <code>fluidpatcher/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Write current configuration stored in `cfg` to file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cfgfile</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">renderyaml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fluidpatcher.FluidPatcher.load_bank" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_bank</span><span class="p">(</span><span class="n">bankfile</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Load a bank from a file or from raw yaml text</p>
<p>Parses a yaml stream from a string or file and stores as a
nested collection of dict and list objects. The top-level
dict must have at minimum a <code>patches</code> element or an error
is raised. If loaded from a file successfully, that file
is set as <code>currentbank</code> in the config - call update_config()
to make it persistent.</p>
<p>Upon loading, resets the synth, loads all necessary soundfonts,
and applies settings in the <code>init</code> element. Returns the yaml stream
as a string. If called with no arguments, resets the synth and
restores the current bank from memory.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>bankfile</code></b>
              â€“
              <div class="doc-md-description">
                <p>bank file to load, absolute or relative to <code>bankdir</code></p>
              </div>
            </li>
            <li>
              <b><code>raw</code></b>
              â€“
              <div class="doc-md-description">
                <p>string to parse directly</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>Returns: yaml stream that was loaded</p>

            <details class="quote">
              <summary>Source code in <code>fluidpatcher/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_bank</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bankfile</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load a bank from a file or from raw yaml text</span>

<span class="sd">    Parses a yaml stream from a string or file and stores as a</span>
<span class="sd">    nested collection of dict and list objects. The top-level</span>
<span class="sd">    dict must have at minimum a `patches` element or an error</span>
<span class="sd">    is raised. If loaded from a file successfully, that file</span>
<span class="sd">    is set as `currentbank` in the config - call update_config()</span>
<span class="sd">    to make it persistent.</span>

<span class="sd">    Upon loading, resets the synth, loads all necessary soundfonts,</span>
<span class="sd">    and applies settings in the `init` element. Returns the yaml stream</span>
<span class="sd">    as a string. If called with no arguments, resets the synth and</span>
<span class="sd">    restores the current bank from memory.</span>

<span class="sd">    Args:</span>
<span class="sd">      bankfile: bank file to load, absolute or relative to `bankdir`</span>
<span class="sd">      raw: string to parse directly</span>

<span class="sd">    Returns: yaml stream that was loaded</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">bankfile</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">raw</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bankdir</span> <span class="o">/</span> <span class="n">bankfile</span><span class="p">)</span><span class="o">.</span><span class="n">read_text</span><span class="p">()</span>
            <span class="n">bank</span> <span class="o">=</span> <span class="n">parseyaml</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">bankfile</span><span class="p">)</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;currentbank&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;currentbank&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">raise</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bank</span> <span class="o">=</span> <span class="n">bank</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;currentbank&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">bankfile</span><span class="p">)</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">raw</span><span class="p">:</span>
        <span class="n">bank</span> <span class="o">=</span> <span class="n">parseyaml</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bank</span> <span class="o">=</span> <span class="n">bank</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_reset_synth</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_bankfonts</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">zone</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bank</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;patches&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">midi</span> <span class="ow">in</span> <span class="n">zone</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;midiplayers&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">midi</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mfilesdir</span> <span class="o">/</span> <span class="n">midi</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">fx</span> <span class="ow">in</span> <span class="n">zone</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ladspafx&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">fx</span><span class="p">[</span><span class="s1">&#39;lib&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plugindir</span> <span class="o">/</span> <span class="n">fx</span><span class="p">[</span><span class="s1">&#39;lib&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">syx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;init&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sysex&#39;</span><span class="p">,</span> <span class="p">[]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="n">syx</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">opt</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;init&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fluidsettings&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fluidsetting_set</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;init&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;messages&#39;</span><span class="p">,</span> <span class="p">[]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_event</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">raw</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fluidpatcher.FluidPatcher.save_bank" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_bank</span><span class="p">(</span><span class="n">bankfile</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Save a bank file</p>
<p>Saves the current bank in memory to <code>bankfile</code> after rendering it as
a yaml stream. If <code>raw</code> is provided, it is parsed as the new bank and
its exact contents are written to the file.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>bankfile</code></b>
              â€“
              <div class="doc-md-description">
                <p>file to save, absolute or relative to <code>bankdir</code></p>
              </div>
            </li>
            <li>
              <b><code>raw</code></b>
              â€“
              <div class="doc-md-description">
                <p>exact text to save</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>fluidpatcher/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">save_bank</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bankfile</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Save a bank file</span>

<span class="sd">    Saves the current bank in memory to `bankfile` after rendering it as</span>
<span class="sd">    a yaml stream. If `raw` is provided, it is parsed as the new bank and</span>
<span class="sd">    its exact contents are written to the file.</span>

<span class="sd">    Args:</span>
<span class="sd">      bankfile: file to save, absolute or relative to `bankdir`</span>
<span class="sd">      raw: exact text to save</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">raw</span><span class="p">:</span>
        <span class="n">bank</span> <span class="o">=</span> <span class="n">parseyaml</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bank</span> <span class="o">=</span> <span class="n">bank</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">raw</span> <span class="o">=</span> <span class="n">renderyaml</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bank</span><span class="p">)</span>
    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bankdir</span> <span class="o">/</span> <span class="n">bankfile</span><span class="p">)</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;currentbank&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">bankfile</span><span class="p">)</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fluidpatcher.FluidPatcher.apply_patch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">apply_patch</span><span class="p">(</span><span class="n">patch</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Select a patch and apply its settings</p>
<p>Read the settings for the patch specified by index or name and combine
them with bank-level settings. Select presets on specified channels and
unsets others, clears router rules and applies new ones, activates 
players and effects and deactivates unused ones, send messages, and
applies fluidsettings. Patch settings are applied after bank settings.
If the specified patch isn't found, only bank settings are applied.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>patch</code></b>
              â€“
              <div class="doc-md-description">
                <p>patch index or name</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>Returns: a list of warnings, if any</p>

            <details class="quote">
              <summary>Source code in <code>fluidpatcher/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">apply_patch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patch</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Select a patch and apply its settings</span>

<span class="sd">    Read the settings for the patch specified by index or name and combine</span>
<span class="sd">    them with bank-level settings. Select presets on specified channels and</span>
<span class="sd">    unsets others, clears router rules and applies new ones, activates </span>
<span class="sd">    players and effects and deactivates unused ones, send messages, and</span>
<span class="sd">    applies fluidsettings. Patch settings are applied after bank settings.</span>
<span class="sd">    If the specified patch isn&#39;t found, only bank settings are applied.</span>

<span class="sd">    Args:</span>
<span class="sd">      patch: patch index or name</span>

<span class="sd">    Returns: a list of warnings, if any</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">warnings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">patch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_patch</span><span class="p">(</span><span class="n">patch</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">mrg</span><span class="p">(</span><span class="n">kw</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kw</span><span class="p">,</span> <span class="p">{})</span> <span class="o">|</span> <span class="n">patch</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kw</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kw</span><span class="p">,</span> <span class="p">[])</span> <span class="o">+</span> <span class="n">patch</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kw</span><span class="p">,</span> <span class="p">[])</span>
    <span class="c1"># presets</span>
    <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_channels</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">:=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bank</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span> <span class="ow">or</span> <span class="n">patch</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ch</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">program_select</span><span class="p">(</span><span class="n">ch</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sfdir</span> <span class="o">/</span> <span class="n">p</span><span class="o">.</span><span class="n">sfont</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">bank</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">prog</span><span class="p">):</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unable to select preset </span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2"> on channel </span><span class="si">{</span><span class="n">ch</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">program_unset</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span>
    <span class="c1"># sysex</span>
    <span class="k">for</span> <span class="n">syx</span> <span class="ow">in</span> <span class="n">mrg</span><span class="p">(</span><span class="s1">&#39;sysex&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">send_sysex</span><span class="p">(</span><span class="n">syx</span><span class="p">)</span>
    <span class="c1"># fluidsettings</span>
    <span class="k">for</span> <span class="n">opt</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">mrg</span><span class="p">(</span><span class="s1">&#39;fluidsettings&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fluidsetting_set</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
    <span class="c1"># sequencers, arpeggiators, midiplayers</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">players_clear</span><span class="p">(</span><span class="n">save</span><span class="o">=</span><span class="p">[</span><span class="o">*</span><span class="n">mrg</span><span class="p">(</span><span class="s1">&#39;sequencers&#39;</span><span class="p">),</span> <span class="o">*</span><span class="n">mrg</span><span class="p">(</span><span class="s1">&#39;arpeggiators&#39;</span><span class="p">),</span> <span class="o">*</span><span class="n">mrg</span><span class="p">(</span><span class="s1">&#39;midiplayers&#39;</span><span class="p">)])</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">seq</span> <span class="ow">in</span> <span class="n">mrg</span><span class="p">(</span><span class="s1">&#39;sequencers&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">sequencer_add</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">seq</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">arp</span> <span class="ow">in</span> <span class="n">mrg</span><span class="p">(</span><span class="s1">&#39;arpeggiators&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">arpeggiator_add</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">arp</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">midi</span> <span class="ow">in</span> <span class="n">mrg</span><span class="p">(</span><span class="s1">&#39;midiplayers&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">midiplayer_add</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">midi</span><span class="p">)</span>
    <span class="c1"># ladspa effects</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">fxchain_clear</span><span class="p">(</span><span class="n">save</span><span class="o">=</span><span class="n">mrg</span><span class="p">(</span><span class="s1">&#39;ladspafx&#39;</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">fx</span> <span class="ow">in</span> <span class="p">(</span><span class="n">mrg</span><span class="p">(</span><span class="s1">&#39;ladspafx&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">patchcord</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">fxchain_add</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">fx</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">fxchain_connect</span><span class="p">()</span>
    <span class="c1"># router rules -- invert b/c fluidsynth applies rules last-first</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">router_default</span><span class="p">()</span>
    <span class="n">rules</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="n">mrg</span><span class="p">(</span><span class="s1">&#39;router_rules&#39;</span><span class="p">)][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="s1">&#39;clear&#39;</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">router_clear</span><span class="p">()</span>
        <span class="n">rules</span> <span class="o">=</span> <span class="n">rules</span><span class="p">[:</span><span class="n">rules</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;clear&#39;</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">:</span>
        <span class="n">rule</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">router_addrule</span><span class="p">)</span>
    <span class="c1"># midi messages</span>
    <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">mrg</span><span class="p">(</span><span class="s1">&#39;messages&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_event</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">warnings</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fluidpatcher.FluidPatcher.add_patch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_patch</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">addlike</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Add a new patch</p>
<p>Create a new empty patch, or one that copies all settings
other than instruments from an existing patch</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>name</code></b>
              â€“
              <div class="doc-md-description">
                <p>a name for the new patch</p>
              </div>
            </li>
            <li>
              <b><code>addlike</code></b>
              â€“
              <div class="doc-md-description">
                <p>number or name of an existing patch</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>Returns: the index of the new patch</p>

            <details class="quote">
              <summary>Source code in <code>fluidpatcher/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_patch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">addlike</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a new patch</span>

<span class="sd">    Create a new empty patch, or one that copies all settings</span>
<span class="sd">    other than instruments from an existing patch</span>

<span class="sd">    Args:</span>
<span class="sd">      name: a name for the new patch</span>
<span class="sd">      addlike: number or name of an existing patch</span>

<span class="sd">    Returns: the index of the new patch</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;patches&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bank</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">bank</span><span class="p">[</span><span class="s1">&#39;patches&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bank</span><span class="p">[</span><span class="s1">&#39;patches&#39;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">addlike</span><span class="p">:</span>
        <span class="n">addlike</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_patch</span><span class="p">(</span><span class="n">addlike</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">addlike</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bank</span><span class="p">[</span><span class="s1">&#39;patches&#39;</span><span class="p">][</span><span class="n">name</span><span class="p">][</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">addlike</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fluidpatcher.FluidPatcher.update_patch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_patch</span><span class="p">(</span><span class="n">patch</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Update the current patch</p>
<p>Instruments and controller values can be changed by program change (PC)
and continuous controller (CC) messages, but these will not persist
in the patch unless this function is called. Settings can be saved to
a new patch by first calling add_patch(), then update_patch() on the
new patch. The bank file must be saved for updated patches to become
permanent.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>patch</code></b>
              â€“
              <div class="doc-md-description">
                <p>index or name of the patch to update</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>fluidpatcher/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update_patch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patch</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update the current patch</span>

<span class="sd">    Instruments and controller values can be changed by program change (PC)</span>
<span class="sd">    and continuous controller (CC) messages, but these will not persist</span>
<span class="sd">    in the patch unless this function is called. Settings can be saved to</span>
<span class="sd">    a new patch by first calling add_patch(), then update_patch() on the</span>
<span class="sd">    new patch. The bank file must be saved for updated patches to become</span>
<span class="sd">    permanent.</span>

<span class="sd">    Args:</span>
<span class="sd">      patch: index or name of the patch to update</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">patch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_patch</span><span class="p">(</span><span class="n">patch</span><span class="p">)</span>
    <span class="n">messages</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">patch</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;messages&#39;</span><span class="p">,</span> <span class="p">[]))</span>
    <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_channels</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">cc</span><span class="p">,</span> <span class="n">default</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">_CC_DEFAULTS</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">default</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span> <span class="k">continue</span>
            <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">get_cc</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="n">cc</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">val</span> <span class="o">!=</span> <span class="n">default</span><span class="p">:</span>
                <span class="n">messages</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">MidiMessage</span><span class="p">(</span><span class="s1">&#39;cc&#39;</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="n">cc</span><span class="p">,</span> <span class="n">val</span><span class="p">))</span>
        <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">program_info</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">info</span><span class="p">:</span>
            <span class="n">patch</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">channel</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="n">sfont</span><span class="p">,</span> <span class="n">bank</span><span class="p">,</span> <span class="n">prog</span> <span class="o">=</span> <span class="n">info</span>
        <span class="n">sfrel</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">sfont</span><span class="p">)</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sfdir</span><span class="p">)</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()</span>
        <span class="n">patch</span><span class="p">[</span><span class="n">channel</span><span class="p">]</span> <span class="o">=</span> <span class="n">SFPreset</span><span class="p">(</span><span class="n">sfrel</span><span class="p">,</span> <span class="n">bank</span><span class="p">,</span> <span class="n">prog</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">messages</span><span class="p">:</span>
        <span class="n">patch</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fluidpatcher.FluidPatcher.delete_patch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete_patch</span><span class="p">(</span><span class="n">patch</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Delete a patch from the bank in memory</p>
<p>Bank file must be saved for deletion to be permanent</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>patch</code></b>
              â€“
              <div class="doc-md-description">
                <p>index or name of the patch to delete</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>fluidpatcher/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">delete_patch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patch</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Delete a patch from the bank in memory</span>

<span class="sd">    Bank file must be saved for deletion to be permanent</span>

<span class="sd">    Args:</span>
<span class="sd">      patch: index or name of the patch to delete</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">patch</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patches</span><span class="p">[</span><span class="n">patch</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">patch</span>
    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">bank</span><span class="p">[</span><span class="s1">&#39;patches&#39;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_bankfonts</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fluidpatcher.FluidPatcher.fluidsetting_get" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fluidsetting_get</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Get the current value of a FluidSynth setting</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>opt</code></b>
              â€“
              <div class="doc-md-description">
                <p>setting name</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>Returns: the setting's current value as float, int, or str</p>

            <details class="quote">
              <summary>Source code in <code>fluidpatcher/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fluidsetting_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opt</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the current value of a FluidSynth setting</span>

<span class="sd">    Args:</span>
<span class="sd">      opt: setting name</span>

<span class="sd">    Returns: the setting&#39;s current value as float, int, or str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fluidpatcher.FluidPatcher.fluidsetting_set" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fluidsetting_set</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">patch</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Change a FluidSynth setting</p>
<p>Modifies a FluidSynth setting. Settings without a "synth." prefix
are ignored. If <code>patch</code> is provided, these settings are also added to
the current bank in memory at bank level, and any conflicting
settings are removed from the specified patch - which should ideally
be the current patch so that the changes can be heard. The bank file
must be saved for the changes to become permanent.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>opt</code></b>
              â€“
              <div class="doc-md-description">
                <p>setting name</p>
              </div>
            </li>
            <li>
              <b><code>val</code></b>
              â€“
              <div class="doc-md-description">
                <p>new value to set, type depends on setting</p>
              </div>
            </li>
            <li>
              <b><code>patch</code></b>
              â€“
              <div class="doc-md-description">
                <p>patch name or index</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>fluidpatcher/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fluidsetting_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">patch</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Change a FluidSynth setting</span>

<span class="sd">    Modifies a FluidSynth setting. Settings without a &quot;synth.&quot; prefix</span>
<span class="sd">    are ignored. If `patch` is provided, these settings are also added to</span>
<span class="sd">    the current bank in memory at bank level, and any conflicting</span>
<span class="sd">    settings are removed from the specified patch - which should ideally</span>
<span class="sd">    be the current patch so that the changes can be heard. The bank file</span>
<span class="sd">    must be saved for the changes to become permanent.</span>

<span class="sd">    Args:</span>
<span class="sd">      opt: setting name</span>
<span class="sd">      val: new value to set, type depends on setting</span>
<span class="sd">      patch: patch name or index</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">opt</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;synth.&#39;</span><span class="p">):</span> <span class="k">return</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">setting</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">patch</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;fluidsettings&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bank</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bank</span><span class="p">[</span><span class="s1">&#39;fluidsettings&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bank</span><span class="p">[</span><span class="s1">&#39;fluidsettings&#39;</span><span class="p">][</span><span class="n">opt</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="n">patch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_patch</span><span class="p">(</span><span class="n">patch</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;fluidsettings&#39;</span> <span class="ow">in</span> <span class="n">patch</span> <span class="ow">and</span> <span class="n">opt</span> <span class="ow">in</span> <span class="n">patch</span><span class="p">[</span><span class="s1">&#39;fluidsettings&#39;</span><span class="p">]:</span>
            <span class="k">del</span> <span class="n">patch</span><span class="p">[</span><span class="s1">&#39;fluidsettings&#39;</span><span class="p">][</span><span class="n">opt</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fluidpatcher.FluidPatcher.add_router_rule" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_router_rule</span><span class="p">(</span><span class="o">**</span><span class="n">pars</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Add a router rule to the Synth</p>
<p>Directly add a router rule to the Synth. This rule will be added
after the current bank- and patch-level rules. The rule is not
saved to the bank, and will disappear if a patch is applied
or the synth is reset.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>pars</code></b>              â€“
              <div class="doc-md-description">
                <p>router rule as a set of key=value pairs</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>fluidpatcher/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_router_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">pars</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a router rule to the Synth</span>

<span class="sd">    Directly add a router rule to the Synth. This rule will be added</span>
<span class="sd">    after the current bank- and patch-level rules. The rule is not</span>
<span class="sd">    saved to the bank, and will disappear if a patch is applied</span>
<span class="sd">    or the synth is reset.</span>

<span class="sd">    Returns:</span>
<span class="sd">      pars: router rule as a set of key=value pairs</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">RouterRule</span><span class="p">(</span><span class="o">**</span><span class="n">pars</span><span class="p">)</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">router_addrule</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fluidpatcher.FluidPatcher.send_event" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">send_event</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;note&#39;</span><span class="p">,</span> <span class="n">chan</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">par1</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">par2</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Send a MIDI event to the Synth</p>
<p>Sends a MidiMessage, or constructs one from a bank file-styled string
(<type>:<channel>:<par1>:<par2>) or keywords and sends it
to the Synth, which will apply all current router rules.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>msg</code></b>
              â€“
              <div class="doc-md-description">
                <p>MidiMessage instance or string</p>
              </div>
            </li>
            <li>
              <b><code>type</code></b>
              â€“
              <div class="doc-md-description">
                <p>event type as string</p>
              </div>
            </li>
            <li>
              <b><code>chan</code></b>
              â€“
              <div class="doc-md-description">
                <p>MIDI channel</p>
              </div>
            </li>
            <li>
              <b><code>par1</code></b>
              â€“
              <div class="doc-md-description">
                <p>first parameter, integer or note name</p>
              </div>
            </li>
            <li>
              <b><code>par2</code></b>
              â€“
              <div class="doc-md-description">
                <p>second parameter for valid types</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
            <details class="quote">
              <summary>Source code in <code>fluidpatcher/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">send_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;note&#39;</span><span class="p">,</span> <span class="n">chan</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">par1</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">par2</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Send a MIDI event to the Synth</span>

<span class="sd">    Sends a MidiMessage, or constructs one from a bank file-styled string</span>
<span class="sd">    (&lt;type&gt;:&lt;channel&gt;:&lt;par1&gt;:&lt;par2&gt;) or keywords and sends it</span>
<span class="sd">    to the Synth, which will apply all current router rules.</span>

<span class="sd">    Args:</span>
<span class="sd">      msg: MidiMessage instance or string</span>
<span class="sd">      type: event type as string</span>
<span class="sd">      chan: MIDI channel</span>
<span class="sd">      par1: first parameter, integer or note name</span>
<span class="sd">      par2: second parameter for valid types</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">parseyaml</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">msg</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">MidiMessage</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">chan</span><span class="p">,</span> <span class="n">par1</span><span class="p">,</span> <span class="n">par2</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">send_event</span><span class="p">(</span><span class="o">*</span><span class="n">msg</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fluidpatcher.FluidPatcher.solo_soundfont" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">solo_soundfont</span><span class="p">(</span><span class="n">soundfont</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Suspend the current bank and load a single soundfont</p>
<p>Resets the Synth, loads a single soundfont, and creates router
rules that route messages from all channels to channel 1.
Scans through each bank and program in order and retrieves the
preset name. After this, select_sfpreset() can be used to play
any instrument in the soundfont. Call load_bank() with no
arguments to restore the current bank.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>soundfont</code></b>
              â€“
              <div class="doc-md-description">
                <p>soundfont file to load, absolute or relative to <code>sfdir</code></p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>Returns: a list of (bank, prog, name) tuples for each preset</p>

            <details class="quote">
              <summary>Source code in <code>fluidpatcher/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">solo_soundfont</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">soundfont</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Suspend the current bank and load a single soundfont</span>

<span class="sd">    Resets the Synth, loads a single soundfont, and creates router</span>
<span class="sd">    rules that route messages from all channels to channel 1.</span>
<span class="sd">    Scans through each bank and program in order and retrieves the</span>
<span class="sd">    preset name. After this, select_sfpreset() can be used to play</span>
<span class="sd">    any instrument in the soundfont. Call load_bank() with no</span>
<span class="sd">    arguments to restore the current bank.</span>

<span class="sd">    Args:</span>
<span class="sd">      soundfont: soundfont file to load, absolute or relative to `sfdir`</span>

<span class="sd">    Returns: a list of (bank, prog, name) tuples for each preset</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">sfont</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">soundfonts</span> <span class="o">-</span> <span class="p">{</span><span class="n">soundfont</span><span class="p">}:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">unload_soundfont</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sfdir</span> <span class="o">/</span> <span class="n">sfont</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">{</span><span class="n">soundfont</span><span class="p">}</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">soundfonts</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">load_soundfont</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sfdir</span> <span class="o">/</span> <span class="n">soundfont</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">soundfonts</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">return</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">soundfonts</span> <span class="o">=</span> <span class="p">{</span><span class="n">soundfont</span><span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_reset_synth</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_channels</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">program_unset</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
    <span class="k">for</span> <span class="nb">type</span> <span class="ow">in</span> <span class="s1">&#39;note&#39;</span><span class="p">,</span> <span class="s1">&#39;cc&#39;</span><span class="p">,</span> <span class="s1">&#39;pbend&#39;</span><span class="p">,</span> <span class="s1">&#39;cpress&#39;</span><span class="p">,</span> <span class="s1">&#39;kpress&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_router_rule</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="nb">type</span><span class="p">,</span> <span class="n">chan</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;2-</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_channels</span><span class="si">}</span><span class="s2">=1&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">get_sfpresets</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sfdir</span> <span class="o">/</span> <span class="n">soundfont</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fluidpatcher.FluidPatcher.select_sfpreset" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">select_sfpreset</span><span class="p">(</span><span class="n">sfont</span><span class="p">,</span> <span class="n">bank</span><span class="p">,</span> <span class="n">prog</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Select a preset on channel 1</p>
<p>Call to select one of the presets in the soundfont loaded
by solo_soundfount(). The variable-length garbage argument
allows this function to be called by unpacking one of the
tuples returned by solo_soundfont().</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>sfont</code></b>
              â€“
              <div class="doc-md-description">
                <p>the soundfont file loaded by solo_soundfont(),
absolute or relative to <code>sfdir</code></p>
              </div>
            </li>
            <li>
              <b><code>bank</code></b>
              â€“
              <div class="doc-md-description">
                <p>the bank to select</p>
              </div>
            </li>
            <li>
              <b><code>prog</code></b>
              â€“
              <div class="doc-md-description">
                <p>the program to select from bank</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>      <p>Returns: a list of warnings, empty if none</p>

            <details class="quote">
              <summary>Source code in <code>fluidpatcher/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">select_sfpreset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sfont</span><span class="p">,</span> <span class="n">bank</span><span class="p">,</span> <span class="n">prog</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Select a preset on channel 1</span>

<span class="sd">    Call to select one of the presets in the soundfont loaded</span>
<span class="sd">    by solo_soundfount(). The variable-length garbage argument</span>
<span class="sd">    allows this function to be called by unpacking one of the</span>
<span class="sd">    tuples returned by solo_soundfont().</span>

<span class="sd">    Args:</span>
<span class="sd">      sfont: the soundfont file loaded by solo_soundfont(),</span>
<span class="sd">        absolute or relative to `sfdir`</span>
<span class="sd">      bank: the bank to select</span>
<span class="sd">      prog: the program to select from bank</span>

<span class="sd">    Returns: a list of warnings, empty if none</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">sfont</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">soundfonts</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">sfont</span><span class="p">)</span><span class="si">}</span><span class="s2"> is not loaded&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fsynth</span><span class="o">.</span><span class="n">program_select</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sfdir</span> <span class="o">/</span> <span class="n">sfont</span><span class="p">,</span> <span class="n">bank</span><span class="p">,</span> <span class="n">prog</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Unable to select preset </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">sfont</span><span class="p">)</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">bank</span><span class="si">:</span><span class="s2">03d</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">prog</span><span class="si">:</span><span class="s2">03d</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><hr />
<p>The <a href="https://geekfunklabs.github.io/fluidpatcher/api_reference/">full API reference</a> can be found in the <a href="https://geekfunklabs.github.io/fluidpatcher">official documentation</a></p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../ladspa_plugins/" class="btn btn-neutral float-left" title="Plugins"><span class="icon icon-circle-arrow-left"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/GeekFunkLabs/fluidpatcher" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../ladspa_plugins/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
